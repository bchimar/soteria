<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" type="text/css" href="css/styles.css"/>
		<script type="text/javascript" src="js/cambiarPestanna.js"></script>
		<script type="text/javascript" src="js/clock.js"></script>
		<script type="text/javascript" src="js/jquery.min.js"></script>
		<script src="js/sweetalert.min.js"></script>
		<script src="js/Chart.min.js"></script>
		<script src="js/utils.js"></script>
		<script type="text/javascript">
			window.history.forward();
			function noBack(){ window.history.forward(); }
			function init(){
				document.getElementById("start_date").disabled=true;
				document.getElementById("stop_date").disabled=true;
				document.getElementById("year").disabled=true;
				
				document.getElementsByTagName("body")[0].style.visibility = "visible";
			}
		</script>
		<title>SOTERIA: Plataforma para la Gestión de Incidentes de Seguridad de la Información</title>
		
	</head>
	
    <body onload="javascript:cambiarPestanna(pestanas,{{ go_tab }}); javascript:startTime(); noBack(); init();" onpageshow="if (event.persisted) noBack();" onunload="" />
	    <div class="banner" style="width:95%; height:1%;">
			<div id="logo">
			    <img src="img/CUD_Marin_Solo_Escudo.png" width=35% height=35% align=left>
			</div>
			<div id="titulo">
				PLATAFORMA SOTERIA: GESTIÓN DE INCIDENTES DE SEGURIDAD DE LA INFORMACIÓN
			</div>
			<div id="zona_login">
				{{ current_user }}
			</div>
			<div id="zona_logout">
				<a href="{{ url_for('logout') }}"><img src="img/LOGOUT.png" width="60"></a>
			</div>
			
		</div>
		
		<div class="clear"></div>
	  
        <div class="contenedor" style="width:95%; height:75%;">	

			<div id="menu_lateral" style="width:15%; height:38%;">
				<fieldset>
					<legend style="text-align: center;"><img src="img/surfing_files.ico" width=20%>Navegación</legend>
					
					<table style="width:auto">
						<tr>
							<td>
								<a href='javascript:cambiarPestanna(pestanas,pestana1);'><img src="img/Warning.ico" width=20% align=right></a>
							</td>
							<td style="width:50%">
								<a href='javascript:cambiarPestanna(pestanas,pestana1);'>Incidentes</a>
							</td>
						</tr>
						<tr>
							<td>
								<a href='javascript:cambiarPestanna(pestanas,pestana2);'><img src="img/CSIRT.png" width=20% align=right></a>
							</td>
							<td>
								<a href='javascript:cambiarPestanna(pestanas,pestana2);'>CSIRT</a>
							</td>
						</tr>
						<tr>
							<td>
								<a href='javascript:cambiarPestanna(pestanas,pestana3);'><img src="img/ENS.png" width=35% align=right></a>
							</td>
							<td>
								<a href='javascript:cambiarPestanna(pestanas,pestana3);'>ENS</a>
							</td>
						</tr>
						<tr>
							<td>
								<a href='javascript:cambiarPestanna(pestanas,pestana4);'><img src="img/RRHH_icono.png" width=25% align=right></a>
							</td>
							<td>
								<a href='javascript:cambiarPestanna(pestanas,pestana4);'>Personal</a>
							</td>
						</tr>
						<tr>
							<td>
								<a href='javascript:cambiarPestanna(pestanas,pestana5);'><img src="img/Stats.ico" width=25% align=right></a>
							</td>
							<td>
								<a href='javascript:cambiarPestanna(pestanas,pestana5);'>An&aacute;lisis</a>
							</td>
						</tr>
						<tr>
							<td>
								<a href='javascript:cambiarPestanna(pestanas,pestana6);'><img src="img/Knowledge.ico" width=20% align=right></a>
							</td>
							<td>
								<a href='javascript:cambiarPestanna(pestanas,pestana6);'>Conocimiento</a>
							</td>
						</tr>
						<tr>
							<td>
								<a href='javascript:cambiarPestanna(pestanas,pestana7);'><img src="img/information.jpg" width=25% align=right></a>
							</td>
							<td>
								<a href='javascript:cambiarPestanna(pestanas,pestana7);'>Información</a>
							</td>
						</tr>
					</table>
				</fieldset>
			
				<div style="margin-top: 20px; margin-left: 15px;"><img src="img/Soteria_titulo.png"></div>
			
				<div id="clock"></div>
				
				<div style="margin-top: 40px; margin-left: -2px;"><a href="{{ url_for('banner') }}"><img src="img/home.png" width=20% height=7%></a></div>
				<div style="margin-top: -58px; margin-left: 65px;"><img src="img/copyright.png" width=40%></div>
			</div>
						
			<div class="ventanatrabajo">
			
				<div id="pestanas">
					<ul id=lista>
						<li id="pestana1"><a href='javascript:cambiarPestanna(pestanas,pestana1);'><img src="img/Warning.ico" width=17.5% height=17.5%">&#32;&#32;&#32;Incidentes</a></li>
						<li id="pestana2"><a href='javascript:cambiarPestanna(pestanas,pestana2);'><img src="img/CSIRT.png" width=12% height=12%>&#32;&#32;&#32;CSIRT</a></li>
						<li id="pestana3"><a href='javascript:cambiarPestanna(pestanas,pestana3);'><img src="img/ENS.png" width=39% height=14%>&#32;&#32;&#32;ENS</a></li>
						<li id="pestana4"><a href='javascript:cambiarPestanna(pestanas,pestana4);'><img src="img/RRHH_icono.png" width=22% height=14%>&#32;&#32;&#32;Personal</a></li>
						<li id="pestana5"><a href='javascript:cambiarPestanna(pestanas,pestana5);'><img src="img/Stats.ico" width=24% height=24%>&#32;&#32;&#32;An&aacute;lisis</a></li>
						<li id="pestana6"><a href='javascript:cambiarPestanna(pestanas,pestana6);'><img src="img/Knowledge.ico" width=11.5% height=11.5%>&#32;&#32;&#32;Conocimiento</a></li>
						<li id="pestana7"><a href='javascript:cambiarPestanna(pestanas,pestana7);'><img src="img/information.jpg" width=17.5% height=17.5%>&#32;&#32;&#32;Información</a></li>
					</ul>
				</div>
					 
				<div id="contenidopestanas" style="width:99%;">
					<div id="cpestana1">
						{% if message != '' %}
							<script type="text/javascript">
								{{ message }}
							</script>							
						{% endif %}
						{{ tab_1_content }}
					</div>
					<div id="cpestana2">
						{% if csirt_update_ok != '' %}
							<script type="text/javascript">
								{{ csirt_update_ok }}
							</script>							
						{% endif %}
						<h1>GESTIÓN DE EQUIPOS DE RESPUESTA</h1>
						{{ table_and_edit_CSIRT }}
						<script type="text/javascript">
							$( '#csirt_id' ).change(function() {
								var team_list_index = {{ team_list_index }};
								var csirt_id = document.getElementById('csirt_id').value;
								
								document.getElementById('staff_1').value = team_list_index[csirt_id][1];
								document.getElementById('staff_2').value = team_list_index[csirt_id][2];
								document.getElementById('staff_3').value = team_list_index[csirt_id][3];
							}).change();
						</script>
					</div>
					<div id="cpestana3">
						{{ ens }}
					</div>
					<div id="cpestana4">
						{% if staff_update_ok != '' %}
							<script type="text/javascript">
								{{ staff_update_ok }}
							</script>							
						{% endif %}
						{% if new_user_ok != '' %}
							<script type="text/javascript">
								{{ new_user_ok }}
							</script>							
						{% endif %}
						<h1>GESTIÓN DE PERSONAL RESPONSABLE DE SEGURIDAD</h1>
						{{ table_STAFF }}
						{{ edit_STAFF }}
					</div>
					<div id="cpestana5">
					
						<script type="text/javascript">
							document.getElementsByTagName("body")[0].style.visibility = "visible";
						</script>
					
						{% if show_graph == '1' %}
						<fieldset style="width:65%; margin-left: -2%; border: none;">
							<canvas id="incid_stats" style="border:2px solid #0000FF;"></canvas>
						</fieldset>
						
						<fieldset style="position: absolute; top: 18%; left: 70%;">
						<legend style="font-size: 18px; font-weight: bold;">Estadísticas</legend>
							{% if option == '0' or option == '6' %}
								Total: {{ stats[0] }}<br/>
								Media: {{ stats[1] }}<br/>
								Mínimo: {{ stats[2] }} {{ stats[3] }}<br/>
								Máximo: {{ stats[4] }} {{ stats[5] }}
							{% elif option == '1' %}
								Media: {{ stats[1] }} minutos<br/>
								Mínimo: {{ stats[2] }} minutos {{ stats[3] }}<br/>
								Máximo: {{ stats[4] }} minutos {{ stats[5] }}
							{% elif option == '2' %}
								Media: {{ stats[1] }} días<br/>
								Mínimo: {{ stats[2] }} días {{ stats[3] }}<br/>
								Máximo: {{ stats[4] }} días {{ stats[5] }}
							{% elif option == '3' %}
								Total: {{ stats[0] }}<br/>
								Relación FP/incidencias: {{ stats[1] }} %<br/>
								Tiempo medio entre FP (días): {{ stats[2] }}
							{% elif option == '4' %}
								Total: {{ stats[0] }}<br/>
								Relación FN/incidencias: {{ stats[1] }} %<br/>
								Tiempo medio entre FN (días): {{ stats[2] }}
							{% elif option == '5' %}
								Total: {{ stats[0] }}<br/>
								Severidad Crítica: {{ stats[1] }}<br/>
								Severidad Alta: {{ stats[2] }}<br/>
								Severidad Media: {{ stats[3] }}<br/>
								Severidad Baja {{ stats[4] }}<br/><br/>
								Relación Críticas/Total: {{ stats[5] }} %<br/>
								Relación Altas/Total: {{ stats[6] }} %<br/>
								Relación Medias/Total: {{stats[7] }} %<br/>
								Relación Bajas/Total: {{ stats[8] }} %
							{% elif option == '7' %}
								Número de Equipos de Respuesta: {{ stats[0] }}<br/>
								Número de Incidencias totales: {{ stats[1] }}<br/>
								Relación CSIRT's/Nº de Incidencias: {{ stats[2] }} %<br/>
							{% elif option == '8' %}
								Número de Incidencias escaladas: {{ stats[0] }}<br/>
								Número de Incidencias totales: {{ stats[1] }}<br/>
								Relación Incidencias Escaladas/Totales: {{ stats[2] }} %<br/>
							{% elif option == '9' %}
								Total: {{ stats[0] }}<br/>
								Origen automático (SIEM): {{ stats[1] }}<br/>
								Origen manual (Personal): {{ stats[2] }}<br/>
								Relación SIEM/Total: {{ stats[3] }} %<br/>
								Relación Personal/Total: {{ stats[4] }} %
							{% endif %}
						</fieldset>						
						
						{% else %}
					
							{{ stats_option }}
							
							<script type="text/javascript">
								$( '#custom' ).change(function() {		
									var $input = $( this );
									if ($input.is( ":checked" )){
										document.getElementById("start_date").disabled=false;
										document.getElementById("stop_date").disabled=false;
										document.getElementById("year").disabled=true;
									}
								}).change();
								$( '#yearly' ).change(function() {		
									var $input = $( this );
									if ($input.is( ":checked" )){
										document.getElementById("start_date").disabled=true;
										document.getElementById("stop_date").disabled=true;
										document.getElementById("year").disabled=true;
									}
								}).change();
								$( '#monthly' ).change(function() {		
									var $input = $( this );
									if ($input.is( ":checked" )){
										document.getElementById("start_date").disabled=true;
										document.getElementById("stop_date").disabled=true;
										document.getElementById("year").disabled=false;
									}
								}).change();
								$( '#option' ).change(function() {
									var option = document.getElementById("option").value;
									if (option != '0'){
										document.getElementById("yearly").disabled=true;
										document.getElementById("monthly").disabled=true;
										document.getElementById("custom").disabled=true;
										document.getElementById("start_date").disabled=true;
										document.getElementById("stop_date").disabled=true;
										document.getElementById("year").disabled=true;
										document.getElementById("graph_type").value="0";
										document.getElementById("graph_type").disabled=false;
										if (option == '5' || option == '9') {
											document.getElementById("graph_type").value="0";
											document.getElementById("graph_type").disabled=true;
										}
										if (option == '7' || option == '8') {
											document.getElementById("graph_type").value="1";
											document.getElementById("graph_type").disabled=true;
										}
									}
									else {
										document.getElementById("yearly").disabled=false;
										document.getElementById("monthly").disabled=false;
										document.getElementById("custom").disabled=false;
										document.getElementById("yearly").checked=true;
										document.getElementById("graph_type").value="0";
										document.getElementById("graph_type").disabled=false;
									}
								}).change();
							</script>
							
						{% endif %}
						
					</div>
					<div id="cpestana6">
						{{ knowledge }}
					</div>
					<div id="cpestana7">
						{{ info }}
					</div>
				</div>
			
			</div>

			
        </div>
		
		<div class="clear"></div>
		
		<div class="pie" style="width:95%; height:4px;">
			<div id="pie_texto">
				MÁSTER EN GESTIÓN Y DIRECCIÓN DE SISTEMAS Y TECNOLOGÍAS DE LA INFORMACIÓN Y LAS COMUNICACIONES Y DE SEGURIDAD DE LA INFORMACIÓN. TRABAJO FIN DE MÁSTER.
			</div>
		</div>


<script>

	$( '#csirt' ).change(function() {
		var csirt = document.getElementById('csirt');
		var severity = document.getElementById('severity');
		if (csirt.value == "N"){
			document.getElementById("id_csirt").disabled=true;
			document.getElementById("id_csirt").value="";
		} else {
			if (severity.value != "C") {
				alert("No se puede generar un equipo de respuesta para una incidencia de severidad inferior a Crítica!");
				document.getElementById("csirt").value="N";
			}
			else {
				document.getElementById("id_csirt").disabled=false;
				document.getElementById("id_csirt").value="{{ id_csirt }}";
			}
		}
	}).change();


	$( '#severity' ).change(function() {
		var severity = document.getElementById('severity').value;
		
		if (severity != 'C') {
			document.getElementById('csirt').value = 'N';
			document.getElementById('csirt').disabled=true;
			document.getElementById('id_csirt').disabled=true;
		}
		else {
			document.getElementById('csirt').disabled=false;
			document.getElementById('id_csirt').disabled=false;		
		}
	}).change();


	{% if option != '5' and option != '9' %}

	var ctx = document.getElementById("{{ graph }}").getContext('2d');
	if ('{{ huge_data }}' == '1') {
		var myChart = new Chart(ctx, {
			type: '{{ graph_type }}',
			data: {
				labels: {{ labels }},
				datasets: [{
					label: '{{ label }}',
					backgroundColor: 'rgba(75, 192, 192, 0.2)',
					borderColor: 'rgba(54, 162, 235, 1)',
					borderWidth: 1,
					data: {{ data }}
				}]
			},
			options: {
				scales: {
					yAxes: [{
						ticks: {
							min: 0, max: {{stats[4]}}+1
						}
					}],
					xAxes: [{
						ticks: {
							min: 0, max: {{stats[4]}}+1
						}
					}]
				}
			}
		});
	}
	else {
		var myChart = new Chart(ctx, {
			type: '{{ graph_type }}',
			data: {
				labels: {{ labels }},
				datasets: [{
					label: '{{ label }}',
					data: {{ data }},
					backgroundColor: [
						'rgba(54, 162, 235, 0.2)',
						'rgba(75, 192, 192, 0.2)',
						'rgba(153, 102, 255, 0.2)',
						'rgba(255, 99, 132, 0.2)',
						'rgba(255, 159, 64, 0.2)',
						'rgba(255, 99, 132, 0.2)',
						'rgba(75, 192, 192, 0.2)',
						'rgba(153, 102, 255, 0.2)',
						'rgba(54, 162, 235, 0.2)',
						'rgba(255, 159, 64, 0.2)',
						'rgba(255, 99, 132, 0.2)',
						'rgba(75, 192, 192, 0.2)'
					],
					borderColor: [
						'rgba(153, 102, 255, 1)',
						'rgba(54, 162, 235, 1)',
						'rgba(75, 192, 192, 1)',
						'rgba(255,99,132,1)',
						'rgba(255, 159, 64, 1)',
						'rgba(255,99,132,1)',
						'rgba(54, 162, 235, 1)',
						'rgba(75, 192, 192, 1)',
						'rgba(153, 102, 255, 1)',
						'rgba(255, 159, 64, 1)',
						'rgba(255,99,132,1)',
						'rgba(54, 162, 235, 1)'
					],
					borderWidth: 1
				}]
			},
			options: {
				scales: {
					yAxes: [{
						ticks: {
							min: 0
						}
					}],
					xAxes: [{
						ticks: {
							min: 0
						}
					}]
				}
			}
		});
	}

	{% elif option == '5' %}

		var ctx = document.getElementById("{{ graph }}").getContext('2d');

		var myChart = new Chart(ctx, {
			type: 'bar',
			data: {
				labels: {{ labels }},
				datasets: [{
					label: '{{ label[0] }}',
					backgroundColor: window.chartColors.red,
					data: {{ data_set1 }}
				}, {
					label: '{{ label[1] }}',
					backgroundColor: window.chartColors.orange,
					data: {{ data_set2 }}
				}, {
					label: '{{ label[2] }}',
					backgroundColor: window.chartColors.yellow,
					data: {{ data_set3 }}
				}, {
					label: '{{ label[3] }}',
					backgroundColor: window.chartColors.blue,
					data: {{ data_set4 }}
				}]
			},
			options: {
				title: {
				display: true,
				text: 'Distribución por Severidad de las Incidencias'
				},
				scales: {
					yAxes: [{
						ticks: {
							min: 0, max: {{stats[4]}}/3.5
						}
					}],
					xAxes: [{
						ticks: {
							min: 0, max: {{stats[4]}}/3.5
						}
					}]
				}
			}
		});

	{% else %}

		var ctx = document.getElementById("{{ graph }}").getContext('2d');

		var myChart = new Chart(ctx, {
			type: 'bar',
			data: {
				labels: {{ labels }},
				datasets: [{
					label: '{{ label[0] }}',
					backgroundColor: window.chartColors.purple,
					data: {{ data_set1 }}
				}, {
					label: '{{ label[1] }}',
					backgroundColor: window.chartColors.blue,
					data: {{ data_set2 }}
				}]
			},
			options: {
				title: {
				display: true,
				text: 'Distribución de Incidencias según Origen'
				},
				scales: {
					yAxes: [{
						ticks: {
							min: 0, max: {{stats[0]}}/3
						}
					}],
					xAxes: [{
						ticks: {
							min: 0, max: {{stats[0]}}/3
						}
					}]
				}
			}
		});
		
	{% endif %}

</script>
		
	</body>
</html>
